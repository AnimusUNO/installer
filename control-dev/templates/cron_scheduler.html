<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRON Scheduler - Animus Configurator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
</head>
<body>
    {% set page_title = "CRON Scheduler" %}
    {% set back_url = "/settings" %}
    {% set back_text = "Back to Settings" %}
    {% set page_heading = "CRON Scheduler" %}
    {% set page_description = "Manage scheduled tasks and automated jobs" %}
    
    {% include 'includes/page_header.html' %}

            <!-- Action Buttons -->
            <div class="mb-4 d-flex gap-2">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addJobModal">
                    <span>‚ûï</span> Add New Job
                </button>
                <button class="btn btn-outline-secondary" id="refreshJobs">
                    <span>üîÑ</span> Refresh
                </button>
                <button class="btn btn-outline-warning" id="bulkEnable" disabled>
                    <span>‚ñ∂Ô∏è</span> Enable Selected
                </button>
                <button class="btn btn-outline-warning" id="bulkDisable" disabled>
                    <span>‚è∏Ô∏è</span> Disable Selected
                </button>
            </div>

            <!-- Jobs Table -->
            <div class="table-responsive">
                <table class="table table-dark table-hover" id="jobsTable">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 40px;">
                                <input type="checkbox" class="form-check-input" id="selectAll">
                            </th>
                            <th scope="col">Job Name</th>
                            <th scope="col">Schedule</th>
                            <th scope="col">Command</th>
                            <th scope="col">Status</th>
                            <th scope="col">Last Run</th>
                            <th scope="col">Next Run</th>
                            <th scope="col" style="width: 150px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample Jobs -->
                        <tr data-job-id="1">
                            <td>
                                <input type="checkbox" class="form-check-input job-checkbox" value="1">
                            </td>
                            <td>
                                <strong>System Backup</strong>
                                <br><small class="text-muted">Daily system backup</small>
                            </td>
                            <td>
                                <code>0 2 * * *</code>
                                <br><small class="text-muted">Daily at 2:00 AM</small>
                            </td>
                            <td>
                                <code>/usr/local/bin/backup.sh</code>
                            </td>
                            <td>
                                <span class="badge bg-success">Active</span>
                            </td>
                            <td>
                                <small>2024-01-15 02:00:01</small>
                                <br><span class="text-success">‚úì Success</span>
                            </td>
                            <td>
                                <small>2024-01-16 02:00:00</small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" onclick="editJob(1)">‚úèÔ∏è</button>
                                    <button class="btn btn-outline-warning" onclick="toggleJob(1)">‚è∏Ô∏è</button>
                                    <button class="btn btn-outline-danger" onclick="deleteJob(1)">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>

                        <tr data-job-id="2">
                            <td>
                                <input type="checkbox" class="form-check-input job-checkbox" value="2">
                            </td>
                            <td>
                                <strong>Log Rotation</strong>
                                <br><small class="text-muted">Weekly log cleanup</small>
                            </td>
                            <td>
                                <code>0 3 * * 0</code>
                                <br><small class="text-muted">Weekly on Sunday at 3:00 AM</small>
                            </td>
                            <td>
                                <code>/usr/sbin/logrotate /etc/logrotate.conf</code>
                            </td>
                            <td>
                                <span class="badge bg-success">Active</span>
                            </td>
                            <td>
                                <small>2024-01-14 03:00:02</small>
                                <br><span class="text-success">‚úì Success</span>
                            </td>
                            <td>
                                <small>2024-01-21 03:00:00</small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" onclick="editJob(2)">‚úèÔ∏è</button>
                                    <button class="btn btn-outline-warning" onclick="toggleJob(2)">‚è∏Ô∏è</button>
                                    <button class="btn btn-outline-danger" onclick="deleteJob(2)">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>

                        <tr data-job-id="3">
                            <td>
                                <input type="checkbox" class="form-check-input job-checkbox" value="3">
                            </td>
                            <td>
                                <strong>SSL Renewal Check</strong>
                                <br><small class="text-muted">Monthly SSL certificate check</small>
                            </td>
                            <td>
                                <code>0 4 1 * *</code>
                                <br><small class="text-muted">Monthly on 1st at 4:00 AM</small>
                            </td>
                            <td>
                                <code>/usr/bin/certbot renew --quiet</code>
                            </td>
                            <td>
                                <span class="badge bg-warning">Paused</span>
                            </td>
                            <td>
                                <small>2024-01-01 04:00:15</small>
                                <br><span class="text-success">‚úì Success</span>
                            </td>
                            <td>
                                <small>2024-02-01 04:00:00</small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" onclick="editJob(3)">‚úèÔ∏è</button>
                                    <button class="btn btn-outline-success" onclick="toggleJob(3)">‚ñ∂Ô∏è</button>
                                    <button class="btn btn-outline-danger" onclick="deleteJob(3)">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>

                        <tr data-job-id="4">
                            <td>
                                <input type="checkbox" class="form-check-input job-checkbox" value="4">
                            </td>
                            <td>
                                <strong>Database Backup</strong>
                                <br><small class="text-muted">Hourly database backup</small>
                            </td>
                            <td>
                                <code>0 * * * *</code>
                                <br><small class="text-muted">Every hour</small>
                            </td>
                            <td>
                                <code>/usr/local/bin/db-backup.sh</code>
                            </td>
                            <td>
                                <span class="badge bg-danger">Failed</span>
                            </td>
                            <td>
                                <small>2024-01-15 14:00:03</small>
                                <br><span class="text-danger">‚úó Error</span>
                            </td>
                            <td>
                                <small>2024-01-15 15:00:00</small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" onclick="editJob(4)">‚úèÔ∏è</button>
                                    <button class="btn btn-outline-warning" onclick="toggleJob(4)">‚è∏Ô∏è</button>
                                    <button class="btn btn-outline-danger" onclick="deleteJob(4)">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- No Jobs Message -->
            <div class="text-center py-5 d-none" id="noJobsMessage">
                <div class="text-muted">
                    <h4>No scheduled jobs</h4>
                    <p>Create your first scheduled job to get started.</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addJobModal">
                        Add New Job
                    </button>
                </div>
            </div>

            <!-- Tips -->
            <div class="mt-5 pt-4 border-top">
                <p class="text-muted small mb-0">
                    <strong>Tips:</strong> Use standard cron syntax ‚Ä¢ Test commands before scheduling ‚Ä¢ Monitor job execution logs ‚Ä¢ Use descriptive job names
                </p>
            </div>
        </div>
    </main>

    <!-- Add/Edit Job Modal -->
    <div class="modal fade" id="addJobModal" tabindex="-1" aria-labelledby="addJobModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addJobModalLabel">Add New Scheduled Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="jobForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="jobName" class="form-label">Job Name</label>
                                <input type="text" class="form-control" id="jobName" required>
                                <div class="form-text">Descriptive name for the job</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="jobDescription" class="form-label">Description</label>
                                <input type="text" class="form-control" id="jobDescription">
                                <div class="form-text">Optional description</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="scheduleType" class="form-label">Schedule Type</label>
                                <select class="form-select" id="scheduleType">
                                    <option value="custom">Custom Cron</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cronExpression" class="form-label">Cron Expression</label>
                                <input type="text" class="form-control" id="cronExpression" placeholder="* * * * *" required>
                                <div class="form-text">Standard cron format: minute hour day month weekday</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="command" class="form-label">Command</label>
                            <input type="text" class="form-control" id="command" placeholder="/path/to/script.sh" required>
                            <div class="form-text">Full path to the command or script</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="workingDirectory" class="form-label">Working Directory</label>
                                <input type="text" class="form-control" id="workingDirectory" placeholder="/path/to/directory">
                                <div class="form-text">Directory to run command from (optional)</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="user" class="form-label">Run As User</label>
                                <input type="text" class="form-control" id="user" placeholder="root">
                                <div class="form-text">User to run command as (optional)</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="timeout" class="form-label">Timeout (seconds)</label>
                                <input type="number" class="form-control" id="timeout" value="300" min="1">
                                <div class="form-text">Job timeout in seconds</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="retries" class="form-label">Retry Attempts</label>
                                <input type="number" class="form-control" id="retries" value="0" min="0">
                                <div class="form-text">Number of retry attempts on failure</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="enabled" checked>
                                <label class="form-check-label" for="enabled">
                                    Job enabled
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveJob">Save Job</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteJobModal" tabindex="-1" aria-labelledby="deleteJobModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteJobModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the job "<strong id="deleteJobName"></strong>"?</p>
                    <p class="text-warning">This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete Job</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='cron_scheduler.js') }}"></script>
</body>
</html>
